= Project Requirements: Project Puzzlebox
include::share/meta.adoc[]

== Introduction

In this document, the specifications are described prior to the investigation
of the Puzzle Box project. These specifications are partly derived from the
previously established requirements and are further supplemented and modified.
The priority of specifications is indicated using the MoSCoW method, see
<<tab:moscow>>.

[[tab:moscow]]
.MoSCoW Method cite:[Wik22]
[cols="1,3"]
|===
| Priority | Description

| [[must,M]]<<must,Must have>>
| Represents essential system requirements. Without these, the system will not
function.
| [[should,S]]<<should,Should have>>
| Denotes desirable system features. The system can work without these, but it
lacks necessary elements.
| [[could,C]]<<could,Could have>>
| Refers to additional functionalities that can be implemented if there is
extra time.
| [[wont,W]]<<wont,Won't have>>
| Specifies requirements that will not be implemented in the current version
but may be considered in a future release.
|===

This specification document covers hardware, software, and game-specific
details. The focus in this project year for the Puzzle Box is to thoroughly
document the system and create a software framework for future groups.

== Context

This chapter describes how the user will interact with the system. This is done
in the form of a user story. This user story covers hardware, software, and
game specifications. From this narrative, many specifications can be derived
for both functional and non-functional requirements
(<<sec:functional>> and <<sec:technical>>).

The game administrator picks up the puzzle box and places it on a flat surface.
By using the key switch, the puzzle box is turned on, and the green indicator
LED lights up. Through the mesh network established by the external puzzle box
hub, the corresponding web panel can be accessed. The web panel provides
instructions for configuring the puzzle box, including linking it to any bomb.
The instructions issue a warning if any of the start conditions are not
properly set. If a criterion is incorrectly configured, it is highlighted for
resolution. Additionally, a warning is given if the battery capacity is
insufficient for one game duration, causing the indicator LED on the puzzle box
to turn red. In such cases, the battery should be charged using the USB-C
cable. While the puzzle box is charging, the indicator LED is blue. Once there
are no warnings and the puzzle box is adequately charged, the game can be
started in the web panel.

The puzzle box begins with the NeoTrellis game. In this game, players must turn
off all LEDs on an 8x8 button LED matrix. When any button is pressed, the
directly adjacent LEDs toggle. If a lit LED is toggled, it turns off; if an
unlit LED is toggled, it turns on. Once all LEDs are turned off, the game is
solved, and the software puzzle begins.

On the software puzzle, there are 6 banana plug connectors on both the left and
right sides. The ones on the left are labeled with various logical gates, while
the ones on the right are labeled from A to F. Participants in the bomb game
have 6 pieces of C-code written on paper, corresponding to the logical gates on
the puzzle box. The bomb participants must provide a description of the C-code
to the puzzle box participants, allowing them to correctly connect the
appropriate logical gate to the corresponding letter. Once the correct
combination of logical gates with the correct letter is made, the game is
solved. Subsequently, the automation puzzle is initiated.

Since there is no concept available for the automation puzzle yet, the hardware
puzzle is started directly.

The hardware puzzle is played in two distinct phases. In Phase 1, the objective
is to solve a combinatorial circuit such that its output becomes '1'. There are
8 inputs for this circuit, each controlled by an on/off switch. Once the
combinatorial circuit evaluates to '1', the LED at the output lights up,
indicating the completion of the first phase. In Phase 2, another LED blinks,
consistently repeating a pattern. This pattern represents a randomly generated
Morse code, corresponding to a number from 0 to 9999. Participants use a Morse
code table to decipher the correct number. Using four potentiometers, the
participants can set a number on a 7-segment display. When this number matches
the randomly generated one, the hardware puzzle is solved. Subsequently, the
vault puzzle is initiated.

In the vault puzzle, a 7-segment display shows a random combination of a letter
and a digit. Participants have access to a list containing the correct button
combination for the corresponding letter and digit. The vault puzzle consists
of 5 levels, each displaying a unique button combination from the list. When
participants correctly press the button on the keypad, the level advances, and
a new value is shown. Pressing the wrong button restarts the game at level 1.
Once all 5 levels are completed, the vault door unlocks, allowing access to the
inside of the puzzle box. On the mainboard, there is a 7-segment display
showing a code. This code must be relayed to the participants of the bomb game.
Once the bomb team receives the code, the puzzle box is considered solved.

[[sec:functional]]
== Functional Requirements

The functional requirements describe the things which are important to the
client. This is mainly about the way the product is going to be used, what it
is going to look like, and how the product reacts to interaction. This chapter
describes all functional requirements of the puzzle box.

=== The puzzle box

.Puzzle box specifications
[cols="1,1,10"]
|===
| ID | Pri. | Specification

| 001 | <<must>> |
The dimensions of the puzzle box are 30×30×30cm ± 5% (Length × Width × Height).

| 002 | <<must>> |
The puzzle box extends a maximum of 5cm on the sides and the top.

| 003 | <<must>> |
The puzzle box is flat at the bottom.

| <<req:4>> | <<must>> |
[[req:4,R-04]] The puzzle box has a key switch at the bottom of the NeoTrellis puzzle.

| <<req:5>> | <<must>> |
[[req:5,R-05]] The puzzle box has an indicator LED at the bottom of the NeoTrellis puzzle.

| 006 | <<must>> |
The indicator LED turns green when the system is on and not charging.

| 007 | <<must>> |
The indicator LED turns blue when the battery is charging.

| 008 | <<must>> |
The indicator LED turns red when the battery does not have enough capacity for the duration of one game and is not charging.

| 009 | <<must>> |
The puzzle box has a USB-C port at the bottom of the NeoTrellis puzzle for battery charging.

| 010 | <<must>> |
The puzzle box has a distance sensor at the bottom to detect if it is lifted.

| 011 | <<must>> |
The puzzle box main board (PCB on the bottom plate) includes a speaker.

| 012 | <<wont>> |
When the puzzle box is lifted, the mainboard speaker emits an alarm sound for at least 10 seconds. It stops only when it has been on a table for another 10 seconds (detected by the distance sensor).

| 013 | <<wont>> |
When the game is completed, the puzzle box produces a victory sound.

| 014 | <<wont>> |
Pressing the "identify" button on the web panel causes the indicator LED to blink.

| 015 | <<wont>> |
Pressing the "identify" button on the web panel triggers a sound from the speaker.

| 016 | <<wont>> |
The game starts once the scheduler time is reached (refer to section 3.7 - [2]).
|===

=== The bomb

.Puzzle box specifications
[cols="1,1,10"]
|===
| ID | Pri. | Specification

| 017 | <<must>> |
The bomb includes a 6-digit 7-segment display for showing the remaining playtime.

| 018 | <<must>> |
The bomb contains a keypad for entering the disarm code.

| 019 | <<wont>> |
The 6-digit 7-segment display turns off when no game is in progress.

| 020 | <<wont>> |
Once the disarm code is entered on the bomb keypad, the game is complete.

| 021 | <<wont>> |
When the game is finished, the bomb emits a victory sound.

| 022 | <<wont>> |
The timer on the bomb counts down from 60:00:00 to 00:00:00.

| 023 | <<wont>> |
Pressing the "identify" button on the web panel causes the indicator LED to blink.

| 024 | <<wont>> |
Pressing the "identify" button on the web panel triggers a sound from the speaker.

|===

=== The game

[cols="1,1,10"]
|===
| 025 | <<wont>> |
The game lasts for 1 hour.

| 026 | <<wont>> |
The game should be solvable within the given playtime, without the player having prior knowledge of the game or its mechanics.

| 027 | <<must>> |
The puzzles should be easy enough to solve without any prior knowledge of the game or its mechanics.

| 167 | <<must>> |
A puzzle module can manually be reset at the discretion of the game operator

| 168 | <<must>> |
A puzzle module can manually be set as solved at the discretion of the game operator

| 028 | <<wont>> |
The disarm code for the bomb consists of 4 digits.

| 029 | <<wont>> |
Once all games are solved, the mainboard PCB displays the disarm code on a red 7-segment 4-digit screen.

| 030 | <<wont>> |
The puzzle box records the playtime of each game.

| 031 | <<wont>> |
The puzzle box features 5 playable puzzles.

| 032 | <<wont>> |
Only one game is active at a time; the other games do not respond to buttons.

| 033 | <<wont>> |
The game always starts with the NeoTrellis puzzle.
|===

==== NeoTrellis puzzle

[cols="1,1,10"]
|===
| 034 | <<must>> |
There is an 8x8 LED matrix where each LED can display different colors.

| 035 | <<wont>> |
At the start of the puzzle, a pattern is displayed as shown in Figure 4.

| 036 | <<wont>> |
When a button is pressed, the adjacent LEDs and the pressed LED toggle (If an LED is off, it turns on. If an LED is on, it turns off).

| 037 | <<wont>> |
All LEDs in the Neotrellis that are turned on are blue.

| 038 | <<wont>> |
The puzzle is considered solved when all LEDs are turned off, and then the software puzzle starts.
|===

==== Software puzzle

[cols="1,1,10"]
|===
| 039 | <<should>> |
The software puzzle board has 6 banana plug connectors with different logic gates displayed next to them (Refer to Figure 5 for a sketch and Figure 7 for a banana plug example).

| 040 | <<should>> |
The software puzzle board has 6 banana plug connectors labeled with the letters A through F (Refer to Figure 5 for a sketch).

| 041 | <<should>> |
At the start of the puzzle box game, the preparer must connect all cables in parallel (horizontally) to the connectors.

| 042 | <<wont>> |
There are C code blocks visible only to the players on the bomb side, corresponding to the letters A through F (Refer to Figure 6 for the codes).

| 043 | <<should>> |
The combinations of logic gates to letters are always the same.

| 044 | <<wont>> |
The puzzle is considered solved when the cables from the logic gates match the code blocks (Refer to Figure 5 and Figure 6 for the combinations).

| 045 | <<wont>> |
Once the puzzle is solved, the green indicator LED will light up (Refer to Figure 5 and Figure 6).

| 046 | <<wont>> |
After the puzzle is solved, the automation puzzle begins.
|===

==== Automation puzzle

[cols="1,1,10"]
|===
| 047 | <<wont>> |
After the puzzle is solved, the hardware puzzle begins.
|===

==== Hardware puzzle

[cols="1,1,10"]
|===
| 048 | <<should>> |
There are eight switches on the hardware puzzle board.

| 049 | <<should>> |
The hardware puzzle board features a diagram of a combinatorial circuit with 8 inputs (linked to the switches) and 1 output (Refer to Figure 8 for a sketch).

| 050 | <<should>> |
The hardware puzzle board includes a red 7-segment 4-digit display (Refer to Figure 8 for a sketch).

| 051 | <<should>> |
There are 4 potentiometers on the hardware puzzle board (Refer to Figure 8 for a sketch).

| 052 | <<should>> |
A blue LED on the hardware puzzle board displays the morse code.

| 053 | <<should>> |
A green LED on the hardware puzzle board indicates whether the combinatorial circuit is solved.

| 054 | <<wont>> |
At the start of the puzzle, the potentiometers are inactive.

| 055 | <<wont>> |
The 7-segment display is off at the beginning of the puzzle.

| 056 | <<wont>> |
The LED for the combinatorial puzzle is off initially.

| 057 | <<wont>> |
The morse code LED is off at the puzzle's outset.

| 058 | <<must>> |
The preparer must set all switches to the down position at the start of the puzzle box game.

| 059 | <<must>> |
The preparer must turn all potentiometers to the left (value '0') at the beginning of the puzzle box game.

| 060 | <<wont>> |
The puzzle consists of two phases.

| 061 | <<wont>> |
The puzzle begins in phase 1.

| 062 | <<wont>> |
During the puzzle, the switches must be toggled to obtain a logical '1' at the output of the combinatorial circuit.

| 063 | <<wont>> |
When the output of the combinatorial circuit equals '1', the green indicator LED turns on (Refer to Figure 8 for a sketch).

| 064 | <<wont>> |
The puzzle proceeds to phase 2 when the output of the combinatorial circuit is a logical '1'.

| 065 | <<wont>> |
The switches no longer respond once the puzzle enters phase 2.

| 066 | <<wont>> |
The indicator LED from phase 1 remains green during phase 2.

| 067 | <<wont>> |
In phase 2, a morse code is displayed using an LED. This morse code represents 4 numbers from 0 to 9 and repeats every second.

| 068 | <<wont>> |
The morse code is randomly generated.

| 069 | <<wont>> |
Each potentiometer can be rotated to display a value from 0 to 9 on the corresponding 4-digit 7-segment display. The order of the potentiometers matches the order of the segments on the display (Refer to Figure 8 for a sketch).

| 070 | <<wont>> |
The puzzle is considered solved when the code displayed on the 7-segment 4-digit screen matches the 4 numbers from the morse code.

| 071 | <<wont>> |
Once the puzzle is solved, the value shown on the 7-segment 4-digit display cannot be changed.

| 072 | <<wont>> |
A 2-second victory sound is produced by the speaker upon solving the puzzle.

| 073 | <<wont>> |
During the victory sound, the 7-segment display blinks twice per second.

| 074 | <<wont>> |
After the victory sound, the puzzle has been solved and the vault puzzle begins.
|===

==== Vault puzzle

[cols="1,1,10"]
|===
| 075 | <<should>> |
The vault puzzle board features a red 7-segment 4-digit display.

| 076 | <<should>> |
On the vault puzzle board, there is a 4x4 grid of holes for ventilation and sound.

| 077 | <<should>> |
The vault puzzle board includes a vault door, and the inside of the vault is transparent, allowing you to see inside the puzzle box.

| 078 | <<should>> |
A sensor is integrated with the vault to detect when the vault is closed.

| 079 | <<must>> |
At the beginning of the puzzle box game, the preparer must close the vault.

| 080 | <<wont>> |
The puzzle starts at level 1.

| 081 | <<wont>> |
Initially, the 7-segment display shows a code consisting of a letter and a digit. This code represents a valid key combination for level 1 (Refer to Figure 9 for all combinations).

| 082 | <<wont>> |
There are a total of 5 levels. After each level, a key combination is displayed, starting with a letter followed by a digit, which is valid for that level (Refer to Figure 9).

| 083 | <<wont>> |
Each level has unique key combinations for the button locations (Refer to Figure 9).

| 084 | <<wont>> |
Pressing the button corresponding to the letter-digit combinations advances the puzzle to the next level.

| 085 | <<wont>> |
If an incorrect button is pressed, the game resets to level 1.

| 086 | <<wont>> |
An error sound is produced by the speaker when an incorrect button is pressed.

| 087 | <<wont>> |
The 7-segment display blinks when an incorrect button is pressed.

| 088 | <<wont>> |
After completing 5 levels, the puzzle is solved, and the vault opens.
|===

=== Battery

[cols="1,1,10"]
|===
| 089 | <<must>> |
The puzzle box is powered by a rechargeable battery.

| 090 | <<must>> |
The battery lasts for a minimum of 4 hours.

| 091 | <<could>> |
The battery in the puzzle box can be replaced.
|===

=== Network Communication

[cols="1,1,10"]
|===
| 092 | <<wont>> |
The puzzle boxes, bombs, and the puzzle box hub must all be able to communicate with each other.

| 093 | <<must>> |
Communication between two devices in the network must have a range of at least 20 meters in an open field.
|===

=== Framework

[cols="1,1,10"]
|===
| 130 | <<must>> |
The main controller and its software do not need to be modified to implement a new puzzle module

| 131 | <<could>> |
Puzzle modules can be added and removed while the main controller is powered on

| 132 | <<must>> |
Puzzle modules can be added and removed while the main controller is powered off

| 133 | <<must>> |
The puzzle box provides a single external interface for accessing and controlling game state variables
|===

=== Puzzle box hub

[cols="1,1,10"]
|===
| 094 | <<wont>> |
The puzzle box hub hosts a website that can be accessed by a device connected to the network.
|===

[[sec:technical]]
== Technical Requirements

The technical specifications describe the specifications that are important for
developers. For example, this could include specific requirements related to
current, voltage, or communication protocols. This chapter outlines all the
technical specifications of the puzzle box.

=== Wireless communication

[cols="1,1,10"]
|===
| 127 | <<must>> |
The wireless communication between the system controller, bomb, and puzzle box operates over a WiFi mesh or WiFi network.
|===

=== Framework

[cols="1,1,10"]
|===
| 128 | <<must>> |
A framework has been created to assist future groups in the development of the puzzle box.

| 129 | <<must>> |
The framework runs on the main puzzle box controller.

| 134 | <<must>> |
Puzzle modules are detected by the main controller module.

| 135 | <<must>> |
Puzzle modules are initialized by the main controller module.

| 165 | <<must>> |
Puzzle modules repeatedly send 'update' messages to the main controller while their global state is 'uninitialized'
|===

=== Main controller

[cols="1,1,10"]
|===
| 136 | <<must>> |
The main controller has at least 1 I2C peripheral.

| 137 | <<must>> |
The main controller can connect to a standard 802.11b/g/n access point.

| 138 | <<must>> |
The main controller can serve TCP socket connection(s).

| 139 | <<must>> |
The main controller is available as a development kit from Farnell.

| 140 | <<should>> |
The main controller can communicate over I²C with a speed of 400kb/s

| 166 | <<should>> |
The main controller is power efficient.
|===

=== Puzzle module controller

[cols="1,1,10"]
|===
| 141 | <<must>> |
The puzzle module controller has at least 1 I2C peripheral.

| 142 | <<should>> |
The puzzle module controller has enough I/O ports to control a puzzle.

| 143 | <<should>> |
The puzzle module is power efficient.

| 144 | <<must>> |
The puzzle module has a configurable clock speed.

| 145 | <<must>> |
The puzzle module controller is available as a development kit from Farnell.

| 146 | <<should>> |
The puzzle module can communicate over I²C with a speed of 400kb/s
|===

=== Vault puzzle

[cols="1,1,10"]
|===
| 147 | <<must>> |
The vault puzzle can communicate with the main controller using I²C

| 148 | <<wont>> |
The vault puzzle can produce a sound signal for the buzzer

| 149 | <<must>> |
The vault puzzle can lock & unlock a solenoid lock

| 150 | <<must>> |
The vault puzzle can translate and obtain a button press from the 3x4 keypad using 5 inputs

| 151 | <<must>> |
The vault puzzle can communicate with a 4x 7 SEG. Display using 2 lines (clock & data)

| 152 | <<should>> |
The vault puzzle can read a sensor's value to detect if the vault door is open or closed.
|===

=== Bomb

[cols="1,1,10"]
|===
| 153 | <<wont>> |
The bomb can communicate with the hub using a TCP socket connection

| 154 | <<must>> |
The bomb can sync. time using the WiFi connection

| 155 | <<wont>> |
The bomb can retrieve, and store a given code in order to verify it later on input

| 156 | <<should>> |
The bomb can be paired to a puzzlebox using the hub's interface
|===

== Preconditions

[cols="1,11"]
|===
| 160 | The delivery of components cannot take longer than two weeks.
| 161 | The price of a single puzzle box is not higher than €150.
| 162 | The existing games are used in the puzzle box.
| 163 | The puzzle box is not allowed to make a connection with the Avans network (Eduroam).
| 164 | The bomb hardware cannot be changed.
|===

== Documentation

[cols="1,1,10"]
|===
| 157 | <<should>> |
All documentation is written according to the style guide [3]

| 158 | <<should>> |
All documentation is manually checked for spelling and grammar mistakes before being published

| 159 | <<must>> |
All project documents are examined once by Jonathan Overes from Avans
|===

[appendix]
== Explanatory Images

include::share/footer.adoc[]

